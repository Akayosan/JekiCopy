const app=new Vue({el:"#app",data:{popupType:null,popupTitle:window.popupSuccessTitle,isPopupActive:!1,integrationsData:window.integrationsData,isActiveRequest:!1,confirmLanguages:["RU","EN","BG","CZ","DE","ES","GR","HU","ID","IT","PL","PT","RO","RS","SK","TH","TR","VN"],formOptions:{websiteLink:null,isIntegration:!1,selectedIntegration:"email",intagrationData:{},isLandUnique:!1,isAllPageDownload:!1,confirmLanguage:"RU",isMobileVersion:!1,isDefaultDownload:!1},downloadedFiles:0},methods:{download(e,t){const i=document.createElement("a");i.setAttribute("href",t),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},checkProgress(){const e=new XMLHttpRequest,t=`./api/checkProgress?formOptions=${encodeURIComponent(JSON.stringify(this.formOptions))}`;e.open("GET",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=()=>{if(4===e.readyState&&200===e.status){const t=JSON.parse(e.response),i=setInterval((()=>{this.downloadedFiles<t.files?this.downloadedFiles+=1:clearInterval(i)}),10);t.url?(this.download("SaveWeb2ZIP.zip",t.url),gtag("event","download-webpage",{url:""}),this.popupTitle=window.popupSuccessTitle,this.popupType="downloadSuccess",this.isPopupActive=!0,this.isActiveRequest=!1,this.downloadedFiles=t.files):setTimeout((()=>{this.checkProgress()}),1500)}else 4===e.readyState&&404===e.status&&(this.popupTitle=window.popupDeclineTitle,this.popupType="downloadDecline",this.isPopupActive=!0,this.isActiveRequest=!1,this.downloadedFiles=0)},e.send(null)},submitForm(e){e.preventDefault();const t=new XMLHttpRequest,i=`./api/landscrape?formOptions=${encodeURIComponent(JSON.stringify(this.formOptions))}`;t.open("GET",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.responseType="blob",t.onreadystatechange=()=>{4===t.readyState&&200===t.status?this.checkProgress():4===t.readyState&&404===t.status&&(this.popupTitle=window.popupDeclineTitle,this.popupType="downloadDecline",this.isPopupActive=!0,this.isActiveRequest=!1)},t.send(null),this.downloadedFiles=0,this.isActiveRequest=!0},openFormPopup(e){e.preventDefault(),this.popupType="form",this.popupTitle=window.popupFormTitle,this.isPopupActive=!0},successFormPopup(e){e.preventDefault(),this.isPopupActive=!1,this.formOptions.isIntegration=!0},declineFormPopup(e){e.preventDefault(),this.isPopupActive=!1,this.formOptions.isIntegration=!1},closePopup(e){e.preventDefault(),this.isPopupActive=!1,this.formOptions.isIntegration=this.formOptions.isIntegration},isUrlValid:e=>/^https?:\/\/.*/g.test(e),isOnionDomain:e=>/.onion$|.onion\//g.test(e),onChangeUrl(e){!this.isUrlValid(this.formOptions.websiteLink)||0===this.formOptions.websiteLink.length||this.isOnionDomain(this.formOptions.websiteLink)?e.target.setCustomValidity(window.incorrectLink):e.target.setCustomValidity("")},onChangeLang(e){const t=window.location.href,i=e.target.value,o=t.substring(0,t.length-2);window.location.href=o+i}}});